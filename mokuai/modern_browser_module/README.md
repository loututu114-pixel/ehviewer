# ğŸŒ ç°ä»£æµè§ˆå™¨æ¨¡å— (Modern Browser Module)

## ğŸ¯ æ¦‚è¿°

EhViewerç°ä»£æµè§ˆå™¨æ¨¡å—æä¾›å®Œæ•´çš„æµè§ˆå™¨åŠŸèƒ½ä½“éªŒï¼Œå‚è€ƒä¸»æµæµè§ˆå™¨çš„è®¾è®¡ç†å¿µï¼ŒåŒ…å«æ ‡ç­¾é¡µç®¡ç†ã€æ™ºèƒ½åœ°å€æ ã€ä¹¦ç­¾ç³»ç»Ÿã€éšç§æ¨¡å¼ç­‰é«˜çº§åŠŸèƒ½ã€‚é€šè¿‡ä¼˜åŒ–çš„WebViewé…ç½®å’Œæ™ºèƒ½ç¼“å­˜ç­–ç•¥ï¼Œç¡®ä¿å¿«é€Ÿæµç•…çš„æµè§ˆä½“éªŒã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

### ğŸ” æ™ºèƒ½åœ°å€æ 
- âœ… **æ™ºèƒ½è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«URLã€æœç´¢æŸ¥è¯¢ã€æ–‡ä»¶è·¯å¾„ã€å¿«æ·å‘½ä»¤
- âœ… **å®æ—¶å»ºè®®**ï¼šæ™ºèƒ½è¡¥å…¨å’Œæœç´¢å»ºè®®
- âœ… **å¤šæœç´¢å¼•æ“**ï¼šæ”¯æŒç™¾åº¦ã€è°·æ­Œã€å¿…åº”ã€æœç‹—ã€DuckDuckGo
- âœ… **å¿«æ·å‘½ä»¤**ï¼šæ”¯æŒ `:history`ã€`:bookmarks`ã€`:downloads` ç­‰å‘½ä»¤

### ğŸ“‘ æ ‡ç­¾é¡µç®¡ç†
- âœ… **å¤šæ ‡ç­¾é¡µæ”¯æŒ**ï¼šåŒæ—¶ç®¡ç†å¤šä¸ªç½‘é¡µ
- âœ… **éšç§æ¨¡å¼**ï¼šç‹¬ç«‹çš„éšç§æµè§ˆæ ‡ç­¾é¡µ
- âœ… **æ ‡ç­¾é¡µåˆ‡æ¢**ï¼šå¹³æ»‘çš„æ ‡ç­¾é¡µåˆ‡æ¢ä½“éªŒ
- âœ… **çŠ¶æ€ä¿æŒ**ï¼šæ ‡ç­¾é¡µçŠ¶æ€è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤

### ğŸ”’ éšç§ä¿æŠ¤
- âœ… **éšç§æµè§ˆæ¨¡å¼**ï¼šä¸è®°å½•å†å²å’ŒCookie
- âœ… **Cookieç®¡ç†**ï¼šç²¾ç»†çš„Cookieæ§åˆ¶
- âœ… **ç—•è¿¹æ¸…ç†**ï¼šä¸€é”®æ¸…ç†æµè§ˆç—•è¿¹
- âœ… **æ— ç—•æœç´¢**ï¼šéšç§ä¿æŠ¤çš„æœç´¢ä½“éªŒ

### ğŸŒ™ ç•Œé¢ç‰¹æ€§
- âœ… **å¤œé—´æ¨¡å¼**ï¼šæŠ¤çœ¼çš„æ·±è‰²ä¸»é¢˜
- âœ… **æ¡Œé¢æ¨¡å¼**ï¼šåˆ‡æ¢æ¡Œé¢ç‰ˆç½‘é¡µæ˜¾ç¤º
- âœ… **è‡ªé€‚åº”ç¼©æ”¾**ï¼šæ™ºèƒ½è°ƒæ•´é¡µé¢ç¼©æ”¾
- âœ… **æ‰‹åŠ¿æ”¯æŒ**ï¼šä¸°å¯Œçš„è§¦æ‘¸æ‰‹åŠ¿æ“ä½œ

### ğŸ“¥ ä¸‹è½½ç®¡ç†
- âœ… **æ™ºèƒ½ä¸‹è½½**ï¼šè‡ªåŠ¨è¯†åˆ«ä¸‹è½½é“¾æ¥
- âœ… **æ–­ç‚¹ç»­ä¼ **ï¼šæ”¯æŒå¤§æ–‡ä»¶æ–­ç‚¹ç»­ä¼ 
- âœ… **ä¸‹è½½å†å²**ï¼šå®Œæ•´çš„ä¸‹è½½è®°å½•ç®¡ç†
- âœ… **æ–‡ä»¶ç®¡ç†**ï¼šæ™ºèƒ½çš„æ–‡ä»¶ç±»å‹è¯†åˆ«å’Œå¤„ç†

### â­ ä¹¦ç­¾ç³»ç»Ÿ
- âœ… **ä¹¦ç­¾ç®¡ç†**ï¼šæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ä¹¦ç­¾
- âœ… **åˆ†ç±»ç»„ç»‡**ï¼šä¹¦ç­¾æ–‡ä»¶å¤¹å’Œåˆ†ç±»
- âœ… **å¿«é€Ÿæœç´¢**ï¼šä¹¦ç­¾å¿«é€Ÿæœç´¢åŠŸèƒ½
- âœ… **åŒæ­¥æ”¯æŒ**ï¼šä¹¦ç­¾æ•°æ®åŒæ­¥

### ğŸ“š å†å²è®°å½•
- âœ… **è®¿é—®å†å²**ï¼šå®Œæ•´çš„ç½‘é¡µè®¿é—®è®°å½•
- âœ… **æœç´¢å†å²**ï¼šæœç´¢å…³é”®è¯å†å²è®°å½•
- âœ… **æ™ºèƒ½åˆ†ç»„**ï¼šæŒ‰æ—¶é—´å’Œç±»å‹åˆ†ç»„æ˜¾ç¤º
- âœ… **éšç§æ¸…ç†**ï¼šé€‰æ‹©æ€§æ¸…ç†å†å²è®°å½•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```java
// è·å–æµè§ˆå™¨ç®¡ç†å™¨å®ä¾‹
ModernBrowserManager browserManager = ModernBrowserManager.getInstance(context);

// è®¾ç½®å›è°ƒç›‘å¬å™¨
browserManager.setCallback(new ModernBrowserManager.BrowserCallback() {
    @Override
    public void onPageStarted(String url, String title) {
        Log.d(TAG, "å¼€å§‹åŠ è½½: " + url);
        showProgressBar();
    }

    @Override
    public void onPageFinished(String url, String title) {
        Log.d(TAG, "åŠ è½½å®Œæˆ: " + title);
        hideProgressBar();
        updateTitle(title);
        updateUrl(url);
    }

    @Override
    public void onProgressChanged(int progress) {
        updateProgressBar(progress);
    }

    @Override
    public void onReceivedError(int errorCode, String description, String failingUrl) {
        Log.e(TAG, "åŠ è½½é”™è¯¯: " + description);
        showErrorPage(errorCode, description);
    }

    @Override
    public void onTabCreated(ModernBrowserManager.BrowserTab tab) {
        Log.d(TAG, "æ ‡ç­¾é¡µåˆ›å»º: " + tab.title);
        updateTabList();
    }

    @Override
    public void onTabClosed(ModernBrowserManager.BrowserTab tab) {
        Log.d(TAG, "æ ‡ç­¾é¡µå…³é—­: " + tab.title);
        updateTabList();
    }

    @Override
    public void onTabSwitched(ModernBrowserManager.BrowserTab tab) {
        Log.d(TAG, "åˆ‡æ¢æ ‡ç­¾é¡µ: " + tab.title);
        updateCurrentTab(tab);
    }

    @Override
    public void onUrlChanged(String url) {
        updateAddressBar(url);
    }

    @Override
    public void onTitleChanged(String title) {
        updateWindowTitle(title);
    }
});

// åˆ›å»ºç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µ
ModernBrowserManager.BrowserTab firstTab = browserManager.createNewTab();

// åŠ è½½ç½‘é¡µ
browserManager.loadUrl("https://www.google.com");

// å¯¼èˆªæ“ä½œ
browserManager.goBack();     // åé€€
browserManager.goForward();  // å‰è¿›
browserManager.refresh();    // åˆ·æ–°
browserManager.stopLoading(); // åœæ­¢åŠ è½½
```

### é«˜çº§é…ç½®

```java
// åˆ›å»ºè‡ªå®šä¹‰é…ç½®
ModernBrowserManager.ModernBrowserConfig config =
    new ModernBrowserManager.ModernBrowserConfig.Builder()
        .enableJavaScript(true)           // å¯ç”¨JavaScript
        .enableCookies(true)              // å¯ç”¨Cookie
        .enableCache(true)                // å¯ç”¨ç¼“å­˜
        .enableImages(true)               // å¯ç”¨å›¾ç‰‡
        .enableAdsBlock(false)            // ç¦ç”¨å¹¿å‘Šæ‹¦æˆª
        .enableNightMode(false)           // ç¦ç”¨å¤œé—´æ¨¡å¼
        .enableDesktopMode(false)         // ç¦ç”¨æ¡Œé¢æ¨¡å¼
        .setTextZoom(100)                 // æ–‡å­—ç¼©æ”¾100%
        .setUserAgent("Custom/1.0")       // è‡ªå®šä¹‰User-Agent
        .build();

// åº”ç”¨é…ç½®
browserManager.setConfig(config);

// æ¨¡å¼åˆ‡æ¢
browserManager.setIncognitoMode(true);    // éšç§æ¨¡å¼
browserManager.setDesktopMode(true);      // æ¡Œé¢æ¨¡å¼
browserManager.setNightMode(true);        // å¤œé—´æ¨¡å¼
```

## ğŸ“‹ API å‚è€ƒ

### æ ¸å¿ƒç±»

| ç±»å | è¯´æ˜ |
|------|------|
| `ModernBrowserManager` | æµè§ˆå™¨ç®¡ç†å™¨æ ¸å¿ƒç±» |
| `ModernBrowserConfig` | æµè§ˆå™¨é…ç½®ç±» |
| `BrowserCallback` | æµè§ˆå™¨å›è°ƒæ¥å£ |
| `BrowserTab` | æµè§ˆå™¨æ ‡ç­¾é¡µç±» |

### ä¸»è¦æ–¹æ³•

#### ModernBrowserManager

```java
// è·å–å®ä¾‹
ModernBrowserManager getInstance(Context context)

// è®¾ç½®é…ç½®å’Œå›è°ƒ
void setConfig(ModernBrowserConfig config)
void setCallback(BrowserCallback callback)

// æ ‡ç­¾é¡µç®¡ç†
BrowserTab createNewTab()
boolean closeTab(BrowserTab tab)
boolean switchToTab(int index)
BrowserTab getCurrentTab()
List<BrowserTab> getAllTabs()
int getTabCount()

// é¡µé¢å¯¼èˆª
void loadUrl(String url)
void goBack()
void goForward()
void refresh()
void stopLoading()

// çŠ¶æ€æŸ¥è¯¢
boolean canGoBack()
boolean canGoForward()
boolean isLoading()

// æ¨¡å¼è®¾ç½®
void setIncognitoMode(boolean incognito)
void setDesktopMode(boolean desktop)
void setNightMode(boolean night)

// è·å–çŠ¶æ€
ModernBrowserConfig getConfig()
boolean isIncognitoMode()
boolean isDesktopMode()
boolean isNightMode()

// æ¸…ç†èµ„æº
void cleanup()
```

#### BrowserTab

```java
// æ ‡ç­¾é¡µå±æ€§
WebView webView        // WebViewå®ä¾‹
String url            // å½“å‰URL
String title          // é¡µé¢æ ‡é¢˜
Bitmap favicon        // ç½‘ç«™å›¾æ ‡
boolean isIncognito   // æ˜¯å¦ä¸ºéšç§æ ‡ç­¾é¡µ
long createTime       // åˆ›å»ºæ—¶é—´
```

## ğŸ”§ é…ç½®é€‰é¡¹

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `enableJavaScript` | `boolean` | `true` | æ˜¯å¦å¯ç”¨JavaScript |
| `enableCookies` | `boolean` | `true` | æ˜¯å¦å¯ç”¨Cookie |
| `enableCache` | `boolean` | `true` | æ˜¯å¦å¯ç”¨ç¼“å­˜ |
| `enableImages` | `boolean` | `true` | æ˜¯å¦è‡ªåŠ¨åŠ è½½å›¾ç‰‡ |
| `enableAdsBlock` | `boolean` | `false` | æ˜¯å¦å¯ç”¨å¹¿å‘Šæ‹¦æˆª |
| `enableNightMode` | `boolean` | `false` | æ˜¯å¦å¯ç”¨å¤œé—´æ¨¡å¼ |
| `enableDesktopMode` | `boolean` | `false` | æ˜¯å¦å¯ç”¨æ¡Œé¢æ¨¡å¼ |
| `textZoom` | `int` | `100` | æ–‡å­—ç¼©æ”¾ç™¾åˆ†æ¯” |
| `userAgent` | `String` | `""` | è‡ªå®šä¹‰User-Agentå­—ç¬¦ä¸² |

## ğŸ“¦ ä¾èµ–é¡¹

```gradle
dependencies {
    // æ ¸å¿ƒä¾èµ–
    implementation 'com.example:modern-browser-module:1.0.0'

    // å¯é€‰ä¾èµ–ï¼ˆæ ¹æ®éœ€è¦æ·»åŠ ï¼‰
    implementation 'androidx.core:core-ktx:1.10.0'
    implementation 'androidx.appcompat:appcompat:1.6.1'
    implementation 'com.google.android.material:material:1.9.0'
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æƒé™è¦æ±‚
```xml
<!-- åœ¨AndroidManifest.xmlä¸­æ·»åŠ  -->
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

<!-- å¯é€‰æƒé™ -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
```

### WebViewé…ç½®
```xml
<!-- åœ¨AndroidManifest.xmlä¸­æ·»åŠ  -->
<application>
    <meta-data
        android:name="android.webkit.WebView.EnableSafeBrowsing"
        android:value="true" />
</application>
```

### å…¼å®¹æ€§
- **æœ€ä½ç‰ˆæœ¬**: Android API 21 (Android 5.0)
- **ç›®æ ‡ç‰ˆæœ¬**: Android API 34 (Android 14)
- **WebViewç‰ˆæœ¬**: ä¾èµ–ç³»ç»ŸWebViewç‰ˆæœ¬

### æ€§èƒ½ä¼˜åŒ–
```java
// WebViewæ€§èƒ½ä¼˜åŒ–é…ç½®
public class WebViewOptimizer {
    public static void optimize(WebView webView) {
        WebSettings settings = webView.getSettings();

        // ç¡¬ä»¶åŠ é€Ÿ
        webView.setLayerType(View.LAYER_TYPE_HARDWARE, null);

        // ç¼“å­˜ç­–ç•¥
        settings.setCacheMode(WebSettings.LOAD_DEFAULT);
        settings.setAppCacheEnabled(true);

        // æ¸²æŸ“ä¼˜åŒ–
        settings.setRenderPriority(WebSettings.RenderPriority.HIGH);
    }
}
```

### å†…å­˜ç®¡ç†
```java
// WebViewå†…å­˜ç®¡ç†
public class WebViewMemoryManager {
    public static void cleanup(WebView webView) {
        if (webView != null) {
            // æ¸…é™¤ç¼“å­˜
            webView.clearCache(true);
            webView.clearHistory();

            // ç§»é™¤æ‰€æœ‰è§†å›¾
            ViewGroup parent = (ViewGroup) webView.getParent();
            if (parent != null) {
                parent.removeView(webView);
            }

            // é”€æ¯WebView
            webView.destroy();
        }
    }
}
```

## ğŸ”„ å·¥ä½œåŸç†

### æ ‡ç­¾é¡µç®¡ç†ç³»ç»Ÿ

```java
// æ ‡ç­¾é¡µç®¡ç†æ¶æ„
public class TabManager {
    private List<BrowserTab> tabs = new ArrayList<>();
    private int currentTabIndex = 0;
    private static final int MAX_TABS = 99;

    public BrowserTab createTab() {
        if (tabs.size() >= MAX_TABS) {
            return null; // è¾¾åˆ°ä¸Šé™
        }

        BrowserTab tab = new BrowserTab();
        tab.webView = createWebView();
        tabs.add(tab);

        return tab;
    }

    public boolean switchTab(int index) {
        if (index >= 0 && index < tabs.size()) {
            currentTabIndex = index;
            BrowserTab tab = tabs.get(index);

            // æ›´æ–°UIçŠ¶æ€
            updateTabUI(tab);
            return true;
        }
        return false;
    }
}
```

### æ™ºèƒ½åœ°å€æ ç³»ç»Ÿ

```java
// åœ°å€æ æ™ºèƒ½å¤„ç†
public class SmartAddressBar {
    public enum InputType {
        URL,           // å®Œæ•´URL
        DOMAIN,        // åŸŸå
        SEARCH_QUERY,  // æœç´¢å…³é”®è¯
        UNKNOWN       // æœªçŸ¥ç±»å‹
    }

    public static class InputAnalysis {
        public InputType type;
        public String processedUrl;
        public float confidence;
        public List<String> suggestions;
    }

    public InputAnalysis analyzeInput(String input) {
        InputAnalysis analysis = new InputAnalysis();

        // URLæ£€æµ‹
        if (input.contains("://")) {
            analysis.type = InputType.URL;
            analysis.processedUrl = input;
            analysis.confidence = 1.0f;
        }
        // åŸŸåæ£€æµ‹
        else if (input.contains(".") && !input.contains(" ")) {
            analysis.type = InputType.DOMAIN;
            analysis.processedUrl = "https://" + input;
            analysis.confidence = 0.9f;
        }
        // æœç´¢å…³é”®è¯
        else {
            analysis.type = InputType.SEARCH_QUERY;
            analysis.processedUrl = getSearchEngine().getSearchUrl(input);
            analysis.confidence = 0.7f;
        }

        // ç”Ÿæˆå»ºè®®
        analysis.suggestions = generateSuggestions(input, analysis.type);

        return analysis;
    }
}
```

### éšç§ä¿æŠ¤æœºåˆ¶

```java
// éšç§æ¨¡å¼å®ç°
public class PrivacyManager {
    public static void enablePrivacyMode(WebView webView) {
        WebSettings settings = webView.getSettings();

        // ç¦ç”¨ç¼“å­˜
        settings.setCacheMode(WebSettings.LOAD_NO_CACHE);
        settings.setAppCacheEnabled(false);

        // ç¦ç”¨å­˜å‚¨
        settings.setDatabaseEnabled(false);
        settings.setDomStorageEnabled(false);

        // ç¦ç”¨å®šä½
        settings.setGeolocationEnabled(false);

        // ç¦ç”¨è¡¨å•ä¿å­˜
        settings.setSaveFormData(false);
        settings.setSavePassword(false);

        // æ¸…é™¤æ•°æ®
        webView.clearCache(true);
        webView.clearHistory();
        webView.clearFormData();
    }
}
```

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•
```java
@Test
public void testCreateNewTab() {
    // Given
    ModernBrowserManager manager = ModernBrowserManager.getInstance(context);

    // When
    BrowserTab tab = manager.createNewTab();

    // Then
    assertNotNull(tab);
    assertNotNull(tab.webView);
    assertEquals("æ–°æ ‡ç­¾é¡µ", tab.title);
}
```

### é›†æˆæµ‹è¯•
```java
@RunWith(AndroidJUnit4.class)
public class BrowserIntegrationTest {

    @Test
    public void testFullBrowsingFlow() {
        // æµ‹è¯•å®Œæ•´çš„æµè§ˆæµç¨‹
        // 1. åˆ›å»ºæ ‡ç­¾é¡µ
        // 2. åŠ è½½ç½‘é¡µ
        // 3. ç­‰å¾…åŠ è½½å®Œæˆ
        // 4. éªŒè¯é¡µé¢å†…å®¹
        // 5. å…³é—­æ ‡ç­¾é¡µ
    }
}
```

### UIæµ‹è¯•
```java
@RunWith(AndroidJUnit4.class)
public class BrowserUITest {

    @Test
    public void testAddressBarInput() {
        // æµ‹è¯•åœ°å€æ è¾“å…¥å’ŒåŠ è½½
        onView(withId(R.id.address_bar))
            .perform(typeText("https://www.google.com"))
            .perform(pressKey(KeyEvent.KEYCODE_ENTER));

        // éªŒè¯é¡µé¢åŠ è½½
        onView(withId(R.id.webview_container))
            .check(matches(isDisplayed()));
    }
}
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingBrowser`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingBrowser'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingBrowser`)
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache License 2.0 è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](../LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ æ”¯æŒ

- ğŸ“§ é‚®ç®±: support@example.com
- ğŸ“– æ–‡æ¡£: [å®Œæ•´æ–‡æ¡£](https://docs.example.com)
- ğŸ› é—®é¢˜è·Ÿè¸ª: [GitHub Issues](https://github.com/example/repo/issues)

---

**ğŸ’¡ æç¤º**: è¯¥æ¨¡å—é€‚ç”¨äºéœ€è¦å®Œæ•´æµè§ˆå™¨åŠŸèƒ½çš„åº”ç”¨ç¨‹åºï¼Œå¦‚æ–°é—»é˜…è¯»å™¨ã€å†…å®¹èšåˆå™¨ã€ç½‘é¡µæµè§ˆå™¨ç­‰ã€‚
