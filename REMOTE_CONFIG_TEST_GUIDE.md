# è¿œç¨‹é…ç½®æµ‹è¯•æŒ‡å—

## æ¦‚è¿°

EhViewer ç°åœ¨æ”¯æŒé€šè¿‡ GitHub è¿œç¨‹è·å– `sou.json` é…ç½®æ–‡ä»¶ï¼Œå®ç°åŠ¨æ€é…ç½®æœç´¢å’Œé¦–é¡µåŠŸèƒ½ã€‚æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•æµ‹è¯•å’ŒéªŒè¯è¿œç¨‹é…ç½®åŠŸèƒ½ã€‚

## é…ç½®æ–‡ä»¶ä½ç½®

### GitHub è¿œç¨‹é…ç½®
- **ä¸»é…ç½®æ–‡ä»¶**: https://raw.githubusercontent.com/loututu114-pixel/ehviewer/main/sou.json
- **ç¤ºä¾‹é…ç½®æ–‡ä»¶**: https://raw.githubusercontent.com/loututu114-pixel/ehviewer/main/sou_example.json

### æœ¬åœ°é»˜è®¤é…ç½®
- **ä½ç½®**: `app/src/main/res/raw/sou.json`
- **ç”¨é€”**: åº”ç”¨é¦–æ¬¡å®‰è£…æˆ–ç½‘ç»œä¸å¯ç”¨æ—¶çš„åå¤‡é…ç½®

## æµ‹è¯•æ­¥éª¤

### 1. éªŒè¯è¿œç¨‹é…ç½®ä¸‹è½½

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨æµè§ˆå™¨æµ‹è¯•
1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttps://raw.githubusercontent.com/loututu114-pixel/ehviewer/main/sou.json
2. ç¡®è®¤èƒ½æ­£å¸¸è®¿é—®å¹¶æ˜¾ç¤º JSON å†…å®¹
3. æ£€æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¡®

#### æ–¹æ³•äºŒï¼šä½¿ç”¨ curl å‘½ä»¤æµ‹è¯•
```bash
# æµ‹è¯•ä¸»é…ç½®æ–‡ä»¶
curl -I https://raw.githubusercontent.com/loututu114-pixel/ehviewer/main/sou.json

# æµ‹è¯•å®Œæ•´ä¸‹è½½
curl https://raw.githubusercontent.com/loututu114-pixel/ehviewer/main/sou.json
```

### 2. éªŒè¯åº”ç”¨å†…é…ç½®åŠ è½½

#### å¯åŠ¨æ—¥å¿—æ£€æŸ¥
1. å®‰è£…åº”ç”¨å¹¶å¯åŠ¨
2. æŸ¥çœ‹ Android Studio æˆ–è®¾å¤‡æ—¥å¿—
3. æŸ¥æ‰¾ä»¥ä¸‹å…³é”®æ—¥å¿—ï¼š
```log
SearchConfigManager: Detected country code: CN
SearchConfigManager: Detected channel code: google
SearchConfigManager: Loaded local config
SearchConfigManager: Successfully downloaded config, size: XXX bytes
SearchConfigManager: Config updated successfully from remote
SearchConfigManager: Default homepage URL: https://www.baidu.com
```

#### åŠŸèƒ½éªŒè¯
1. **é»˜è®¤é¦–é¡µ**: åº”ç”¨å¯åŠ¨ååº”è¯¥åŠ è½½é…ç½®çš„é»˜è®¤é¦–é¡µ
2. **æœç´¢å¼•æ“**: åœ¨åœ°å€æ è¾“å…¥å…³é”®è¯ï¼Œåº”è¯¥ä½¿ç”¨é…ç½®çš„æœç´¢å¼•æ“
3. **èœå•é€‰é¡¹**: èœå•ä¸­åº”è¯¥æ˜¾ç¤º"ğŸ  è®¾ç½®é¦–é¡µ"é€‰é¡¹
4. **è‡ªå®šä¹‰é¦–é¡µ**: ç‚¹å‡»è®¾ç½®é¦–é¡µåº”è¯¥æ˜¾ç¤ºé¢„è®¾çš„å¿«æ·é€‰é¡¹

### 3. æµ‹è¯•ç½‘ç»œå¼‚å¸¸æƒ…å†µ

#### æ–­ç½‘æµ‹è¯•
1. å…³é—­è®¾å¤‡ç½‘ç»œè¿æ¥
2. é‡å¯åº”ç”¨
3. ç¡®è®¤åº”ç”¨èƒ½æ­£å¸¸ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„é…ç½®
4. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤ç½‘ç»œæ£€æŸ¥é€»è¾‘ï¼š
```log
SearchConfigManager: Network not available, skipping config update
```

#### ç½‘ç»œæ¢å¤æµ‹è¯•
1. æ¢å¤ç½‘ç»œè¿æ¥
2. é‡å¯åº”ç”¨
3. ç¡®è®¤åº”ç”¨èƒ½ä¸‹è½½å¹¶åº”ç”¨æœ€æ–°çš„è¿œç¨‹é…ç½®

### 4. æµ‹è¯•é…ç½®æ›´æ–°

#### ä¿®æ”¹è¿œç¨‹é…ç½®
1. åœ¨ GitHub ä¸Šä¿®æ”¹ `sou.json` æ–‡ä»¶
2. æäº¤å¹¶æ¨é€æ›´æ”¹
3. ç­‰å¾…å‡ åˆ†é’Ÿè®© GitHub raw å†…å®¹æ›´æ–°
4. åœ¨åº”ç”¨ä¸­è§¦å‘é…ç½®æ›´æ–°ï¼š
   - ç­‰å¾…24å°æ—¶è‡ªåŠ¨æ›´æ–°
   - æˆ–è°ƒç”¨ `SearchConfigManager.getInstance(context).forceUpdate()`

#### éªŒè¯é…ç½®ç”Ÿæ•ˆ
1. æ£€æŸ¥åº”ç”¨è¡Œä¸ºæ˜¯å¦æŒ‰æ–°é…ç½®å·¥ä½œ
2. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤é…ç½®å·²æ›´æ–°

## é…ç½®å‚æ•°è¯´æ˜

### homepage é…ç½®
```json
{
  "homepage": {
    "enabled": true,
    "url": "https://www.google.com",      // é»˜è®¤é¦–é¡µURL
    "china": "https://www.baidu.com",     // ä¸­å›½ç”¨æˆ·é¦–é¡µ
    "customOptions": [                    // è‡ªå®šä¹‰é¦–é¡µé€‰é¡¹
      {
        "name": "æ–°é—»é¦–é¡µ",
        "url": "https://news.google.com",
        "china": "https://news.baidu.com"
      }
    ]
  }
}
```

### æœç´¢å¼•æ“é…ç½®
```json
{
  "engines": {
    "google": {
      "name": "Google",
      "url": "https://www.google.com/search?q=%s",
      "suggest": "https://www.google.com/complete/search?client=firefox&q=%s"
    }
  }
}
```

## ç¼“å­˜ç­–ç•¥

### ç¼“å­˜æ—¶é—´
- **å®šæœŸæ›´æ–°**: 24å°æ—¶æ£€æŸ¥ä¸€æ¬¡è¿œç¨‹é…ç½®
- **ç¼“å­˜æœ‰æ•ˆæœŸ**: 7å¤©ï¼Œè¿‡æœŸåå¼ºåˆ¶æ›´æ–°
- **é¦–æ¬¡å¯åŠ¨**: ç«‹å³å°è¯•ä¸‹è½½è¿œç¨‹é…ç½®

### ç¼“å­˜ä½ç½®
- **SharedPreferences**: `search_config` æ–‡ä»¶
- **é”®å€¼**:
  - `config_json`: é…ç½®JSONå­—ç¬¦ä¸²
  - `last_update`: æœ€åæ›´æ–°æ—¶é—´æˆ³

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. é…ç½®æ— æ³•ä¸‹è½½
**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤ºä¸‹è½½å¤±è´¥
**è§£å†³**:
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤ GitHub è®¿é—®æƒé™
- æŸ¥çœ‹é˜²ç«å¢™è®¾ç½®

#### 2. é…ç½®æ ¼å¼é”™è¯¯
**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º JSON è§£æå¤±è´¥
**è§£å†³**:
- éªŒè¯ `sou.json` æ–‡ä»¶æ ¼å¼
- ä½¿ç”¨åœ¨çº¿ JSON éªŒè¯å·¥å…·æ£€æŸ¥è¯­æ³•

#### 3. ç¼“å­˜æœªæ›´æ–°
**ç—‡çŠ¶**: é…ç½®ä¿®æ”¹ååº”ç”¨æœªç”Ÿæ•ˆ
**è§£å†³**:
- ç­‰å¾…24å°æ—¶è‡ªåŠ¨æ›´æ–°
- å¼ºåˆ¶æ¸…é™¤åº”ç”¨æ•°æ®é‡ç½®ç¼“å­˜
- æˆ–è°ƒç”¨å¼ºåˆ¶æ›´æ–°æ–¹æ³•

#### 4. ç½‘ç»œæƒé™é—®é¢˜
**ç—‡çŠ¶**: Android 9+ è®¾å¤‡æ— æ³•è®¿é—® HTTP
**è§£å†³**:
- ç¡®ä¿åœ¨ `AndroidManifest.xml` ä¸­æ·»åŠ ï¼š
```xml
<application android:usesCleartextTraffic="true">
```

### æ—¥å¿—åˆ†æ

#### æˆåŠŸæ—¥å¿—ç¤ºä¾‹
```log
SearchConfigManager: Network available, attempting config update
SearchConfigManager: Successfully downloaded config, size: 1024 bytes
SearchConfigManager: Config updated successfully from remote
SearchConfigManager: Default homepage URL: https://www.baidu.com
```

#### é”™è¯¯æ—¥å¿—ç¤ºä¾‹
```log
SearchConfigManager: Network not available, skipping config update
SearchConfigManager: Failed to download config, response code: 404
SearchConfigManager: Failed to parse downloaded config
```

## æ€§èƒ½ä¼˜åŒ–

### ç½‘ç»œè¯·æ±‚ä¼˜åŒ–
- **è¶…æ—¶è®¾ç½®**: è¿æ¥15ç§’ï¼Œè¯»å–20ç§’
- **é‡è¯•æœºåˆ¶**: æœ€å¤š3æ¬¡é‡è¯•ï¼Œé€’å¢å»¶è¿Ÿ
- **User-Agent**: åŒ…å«åº”ç”¨ç‰ˆæœ¬ä¿¡æ¯

### ç¼“å­˜ä¼˜åŒ–
- **æœ¬åœ°ç¼“å­˜**: é¿å…é‡å¤ç½‘ç»œè¯·æ±‚
- **æ™ºèƒ½æ›´æ–°**: åªåœ¨å¿…è¦æ—¶ä¸‹è½½é…ç½®
- **å†…å­˜ç¼“å­˜**: è¿è¡Œæ—¶ç¼“å­˜è§£æåçš„é…ç½®å¯¹è±¡

## ç›‘æ§å’Œç»Ÿè®¡

### é…ç½®ä½¿ç”¨ç»Ÿè®¡
åº”ç”¨ä¼šè®°å½•ä»¥ä¸‹ç»Ÿè®¡ä¿¡æ¯ï¼š
- é…ç½®ä¸‹è½½æˆåŠŸ/å¤±è´¥æ¬¡æ•°
- ç¼“å­˜å‘½ä¸­ç‡
- ç”¨æˆ·é€‰æ‹©çš„æœç´¢å¼•æ“åå¥½
- é¦–é¡µè®¿é—®ç»Ÿè®¡

### æ—¥å¿—çº§åˆ«
- **DEBUG**: è¯¦ç»†çš„é…ç½®åŠ è½½è¿‡ç¨‹
- **INFO**: é‡è¦çš„é…ç½®æ›´æ–°äº‹ä»¶
- **WARN**: é…ç½®ä¸‹è½½å¤±è´¥ä½†ä¸å½±å“åŠŸèƒ½
- **ERROR**: é…ç½®è§£æå¤±è´¥æˆ–ä¸¥é‡é”™è¯¯

## æœ€ä½³å®è·µ

### é…ç½®ç®¡ç†
1. **ç‰ˆæœ¬æ§åˆ¶**: ä¸ºé…ç½®æ–‡ä»¶å»ºç«‹ç‰ˆæœ¬ç®¡ç†
2. **å‘åå…¼å®¹**: ç¡®ä¿æ–°é…ç½®å…¼å®¹æ—§ç‰ˆæœ¬åº”ç”¨
3. **æµ‹è¯•éªŒè¯**: åœ¨å‘å¸ƒå‰å……åˆ†æµ‹è¯•é…ç½®æ›´æ”¹
4. **å›æ»šè®¡åˆ’**: å‡†å¤‡é…ç½®å›æ»šæ–¹æ¡ˆ

### ç½‘ç»œç­–ç•¥
1. **ç¦»çº¿ä¼˜å…ˆ**: ç¡®ä¿åº”ç”¨åœ¨æ— ç½‘ç»œæ—¶æ­£å¸¸å·¥ä½œ
2. **æ™ºèƒ½é‡è¯•**: é¿å…é¢‘ç¹å¤±è´¥çš„ç½‘ç»œè¯·æ±‚
3. **æµé‡æ§åˆ¶**: åˆç†æ§åˆ¶é…ç½®ä¸‹è½½é¢‘ç‡

### ç”¨æˆ·ä½“éªŒ
1. **æ— ç¼æ›´æ–°**: é…ç½®æ›´æ–°ä¸ä¸­æ–­ç”¨æˆ·ä½¿ç”¨
2. **æ¸è¿›å¼**: æ–°åŠŸèƒ½é€æ­¥æ¨å‡º
3. **ä¸ªæ€§åŒ–**: æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰é…ç½®åå¥½

## æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é…ç½®ç›¸å…³é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- è®¾å¤‡å‹å·å’Œ Android ç‰ˆæœ¬
- ç½‘ç»œç¯å¢ƒï¼ˆWiFi/ç§»åŠ¨æ•°æ®ï¼‰
- å®Œæ•´é”™è¯¯æ—¥å¿—
- é…ç½®æ–‡ä»¶å†…å®¹ï¼ˆè„±æ•åï¼‰
