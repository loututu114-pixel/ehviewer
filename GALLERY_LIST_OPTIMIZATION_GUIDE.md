# ğŸ“Š EhViewer ç”»å»Šåˆ—è¡¨åŠ è½½ä¼˜åŒ–æ–¹æ¡ˆ

> å…¨é¢è§£å†³ç”»å»Šåˆ—è¡¨åŠ è½½ç¼“æ…¢ã€ç½‘ç»œé”™è¯¯ã€ç”¨æˆ·ä½“éªŒå·®ç­‰é—®é¢˜çš„ä¼ä¸šçº§ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ¯ **é—®é¢˜è¯Šæ–­ä¸è§£å†³æ–¹æ¡ˆ**

### ç°æœ‰é—®é¢˜åˆ†æ
ç»è¿‡å¯¹ `EhEngine.getGalleryList()`ã€`GalleryListParser` å’Œ `EhClient` çš„æ·±å…¥åˆ†æï¼Œå‘ç°ç”»å»Šåˆ—è¡¨åŠ è½½ç¼“æ…¢çš„æ ¹æœ¬åŸå› ï¼š

1. **åŒæ­¥ç½‘ç»œè¯·æ±‚**: UIçº¿ç¨‹ç­‰å¾…ç½‘ç»œå“åº”ï¼Œå¯¼è‡´ç•Œé¢å¡é¡¿
2. **ç¼ºä¹ç¼“å­˜æœºåˆ¶**: é‡å¤åŠ è½½ç›¸åŒé¡µé¢ï¼Œæµªè´¹ç½‘ç»œèµ„æº
3. **æ— é¢„åŠ è½½ç­–ç•¥**: ç”¨æˆ·ç¿»é¡µæ—¶éœ€è¦ç­‰å¾…ç½‘ç»œè¯·æ±‚å®Œæˆ
4. **é”™è¯¯å¤„ç†ä¸å®Œå–„**: ç½‘ç»œé”™è¯¯åç”¨æˆ·ä½“éªŒå·®ï¼Œç¼ºä¹æ™ºèƒ½é‡è¯•
5. **æ— ç½‘ç»œçŠ¶å†µé€‚åº”**: ä¸åŒç½‘ç»œç¯å¢ƒä¸‹ä½¿ç”¨ç›¸åŒç­–ç•¥
6. **å†…å­˜ç®¡ç†ç²—ç³™**: ç¼“å­˜æ— é™åˆ¶å¢é•¿å¯èƒ½å¯¼è‡´OOM

### è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ
æˆ‘ä»¬å¼€å‘äº†ä¸€å¥—å®Œæ•´çš„ä¼˜åŒ–ç»„ä»¶ï¼Œå½»åº•è§£å†³è¿™äº›é—®é¢˜ï¼š

## ğŸš€ **æ ¸å¿ƒä¼˜åŒ–ç»„ä»¶**

### 1. **EnhancedGalleryListProvider** - å¢å¼ºå‹ç”»å»Šåˆ—è¡¨æä¾›è€…
```java
ç‰¹æ€§ï¼š
âœ… æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ (å†…å­˜LRUç¼“å­˜ + è¿‡æœŸç®¡ç†)
âœ… å¤šçº¿ç¨‹æ± æ¶æ„ (é«˜ä¼˜å…ˆçº§ + ä½ä¼˜å…ˆçº§)
âœ… ç½‘ç»œçŠ¶æ€æ„ŸçŸ¥ (æ ¹æ®ç½‘ç»œè´¨é‡è°ƒæ•´ç­–ç•¥)
âœ… æ™ºèƒ½é¢„åŠ è½½æœºåˆ¶ (é¢„æµ‹ç”¨æˆ·è¡Œä¸º)
âœ… æŒ‡æ•°é€€é¿é‡è¯• (ç½‘ç»œé”™è¯¯æ™ºèƒ½æ¢å¤)
âœ… å†…å­˜å‹åŠ›ç®¡ç† (åŠ¨æ€è°ƒæ•´ç¼“å­˜å¤§å°)
âœ… æ€§èƒ½ç»Ÿè®¡ç›‘æ§ (å®æ—¶æ€§èƒ½æŒ‡æ ‡)
```

### 2. **NetworkUtils** - ç½‘ç»œçŠ¶æ€æ£€æµ‹å·¥å…·
```java
ç‰¹æ€§ï¼š
âœ… ç²¾ç¡®ç½‘ç»œç±»å‹è¯†åˆ« (WiFi/4G/3G/2G)
âœ… ç½‘ç»œé€Ÿåº¦è¯„ä¼° (Very Fast/Fast/Moderate/Slow)
âœ… è‡ªé€‚åº”é…ç½®æ¨è (è¶…æ—¶/å¹¶å‘/é¢„åŠ è½½)
âœ… å…¼å®¹å¤šAndroidç‰ˆæœ¬ (API 23+)
âœ… å®æ—¶ç½‘ç»œçŠ¶æ€ç›‘æ§
```

### 3. **EnhancedGalleryListAdapter** - å¢å¼ºå‹åˆ—è¡¨é€‚é…å™¨
```java
ç‰¹æ€§ï¼š
âœ… å¹³æ»‘åŠ è½½åŠ¨ç”» (æ·¡å…¥æ•ˆæœ + è¿›åº¦æŒ‡ç¤º)
âœ… æ™ºèƒ½çŠ¶æ€ç®¡ç† (åŠ è½½/é”™è¯¯/ç©ºçŠ¶æ€)
âœ… ç”¨æˆ·å‹å¥½çš„é”™è¯¯å¤„ç† (é‡è¯•æŒ‰é’® + é”™è¯¯æç¤º)
âœ… ç¼“å­˜å‘½ä¸­è§†è§‰åé¦ˆ
âœ… è‡ªåŠ¨åŠ è½½æ›´å¤šæœºåˆ¶
```

## ğŸ“Š **æŠ€æœ¯æ¶æ„**

### ä¼˜åŒ–åçš„æ•°æ®æµæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             UI Layer                â”‚
â”‚  GalleryListScene â”‚ RecyclerView    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Enhanced Adapter                â”‚
â”‚  çŠ¶æ€ç®¡ç† â”‚ åŠ¨ç”»æ•ˆæœ â”‚ é”™è¯¯å¤„ç†     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Enhanced List Provider            â”‚
â”‚  ç¼“å­˜ç®¡ç† â”‚ é¢„åŠ è½½ â”‚ é‡è¯•æœºåˆ¶      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Multi-Thread Pools            â”‚
â”‚  é«˜ä¼˜å…ˆçº§Pool â”‚ ä½ä¼˜å…ˆçº§Pool        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Smart Cache                  â”‚
â”‚  LRUç¼“å­˜ â”‚ è¿‡æœŸç®¡ç† â”‚ å†…å­˜ç›‘æ§     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Network Utils                  â”‚
â”‚  çŠ¶æ€æ£€æµ‹ â”‚ è‡ªé€‚åº”é…ç½® â”‚ æ€§èƒ½ä¼˜åŒ–   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      EhEngine/EhClient              â”‚
â”‚  åŸæœ‰ç½‘ç»œå±‚ (æ— éœ€ä¿®æ”¹)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ™ºèƒ½é¢„åŠ è½½ç­–ç•¥
```java
é¢„åŠ è½½è·ç¦»ç®—æ³•ï¼š
- WiFiç½‘ç»œ: å½“å‰é¡µ Â±5é¡µ (é«˜é€Ÿé¢„åŠ è½½)
- 4Gç½‘ç»œ: å½“å‰é¡µ Â±3é¡µ (æ­£å¸¸é¢„åŠ è½½)
- 3Gç½‘ç»œ: å½“å‰é¡µ Â±2é¡µ (å‡å°‘é¢„åŠ è½½)
- 2Gç½‘ç»œ: å½“å‰é¡µ Â±1é¡µ (æœ€å°é¢„åŠ è½½)
- ç”¨æˆ·æ»šåŠ¨æ–¹å‘æ„ŸçŸ¥: å‘ä¸‹å¤šé¢„åŠ è½½ï¼Œå‘ä¸Šå°‘é¢„åŠ è½½
- å†…å­˜å‹åŠ›æ„ŸçŸ¥: ä½å†…å­˜æ—¶å‡å°‘é¢„åŠ è½½è·ç¦»
```

### ç¼“å­˜ä¼˜å…ˆçº§ç³»ç»Ÿ
```java
ç¼“å­˜ç®¡ç†ç­–ç•¥ï¼š
- CRITICAL: å½“å‰æ˜¾ç¤ºé¡µé¢ (æ°¸ä¸æ¸…ç†)
- HIGH: ç›¸é‚»é¡µé¢ (ä¼˜å…ˆä¿ç•™)
- NORMAL: é¢„åŠ è½½é¡µé¢ (å¯æ¸…ç†)
- LOW: å†å²è®¿é—®é¡µé¢ (ä¼˜å…ˆæ¸…ç†)

è‡ªåŠ¨æ¸…ç†è§¦å‘ç‚¹ï¼š
- 75%å†…å­˜ä½¿ç”¨: å¼€å§‹æ¸…ç†LOWä¼˜å…ˆçº§ç¼“å­˜
- 90%å†…å­˜ä½¿ç”¨: ç´§æ€¥æ¸…ç†NORMALä¼˜å…ˆçº§ç¼“å­˜
- è¿‡æœŸæ—¶é—´: 5åˆ†é’Ÿæœªè®¿é—®è‡ªåŠ¨æ¸…ç†
```

## ğŸ› ï¸ **éƒ¨ç½²æŒ‡å—**

### æ­¥éª¤1: æ·»åŠ ä¼˜åŒ–ç»„ä»¶æ–‡ä»¶
å°†ä»¥ä¸‹æ–‡ä»¶æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼š
```
app/src/main/java/com/hippo/ehviewer/
â”œâ”€â”€ gallery/enhanced/
â”‚   â””â”€â”€ EnhancedGalleryListProvider.java     # æ ¸å¿ƒä¼˜åŒ–æä¾›è€…
â”œâ”€â”€ util/
â”‚   â””â”€â”€ NetworkUtils.java                    # ç½‘ç»œçŠ¶æ€å·¥å…·
â””â”€â”€ ui/scene/gallery/list/
    â””â”€â”€ EnhancedGalleryListAdapter.java      # å¢å¼ºå‹é€‚é…å™¨

app/src/main/res/layout/
â”œâ”€â”€ item_loading_state.xml                   # åŠ è½½çŠ¶æ€å¸ƒå±€
â””â”€â”€ item_error_retry.xml                     # é”™è¯¯é‡è¯•å¸ƒå±€
```

### æ­¥éª¤2: é›†æˆåˆ° GalleryListScene
ä¿®æ”¹ `GalleryListScene.java` ä»¥ä½¿ç”¨ä¼˜åŒ–ç»„ä»¶ï¼š

```java
public class GalleryListScene extends BaseScene implements ... {
    
    private EnhancedGalleryListAdapter mEnhancedAdapter;
    
    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        
        // æ›¿æ¢åŸæœ‰é€‚é…å™¨
        mEnhancedAdapter = new EnhancedGalleryListAdapter(getContext());
        mEnhancedAdapter.setOnGalleryClickListener(this::onGalleryClick);
        mEnhancedAdapter.setOnLoadMoreListener(this::onLoadMore);
        mEnhancedAdapter.setOnRetryListener(this::onRetryLoad);
        
        mRecyclerView.setAdapter(mEnhancedAdapter);
        
        // åˆæ¬¡åŠ è½½
        loadGalleryList();
    }
    
    private void loadGalleryList() {
        String url = buildGalleryListUrl();
        mEnhancedAdapter.loadGalleryList(url, MODE_NORMAL, true);
    }
    
    private void onLoadMore() {
        // åŠ è½½ä¸‹ä¸€é¡µ
        String nextUrl = buildNextPageUrl();
        mEnhancedAdapter.loadGalleryList(nextUrl, MODE_NORMAL, false);
    }
    
    private void onRetryLoad() {
        // é‡è¯•å½“å‰åŠ è½½
        loadGalleryList();
    }
    
    @Override
    protected void onDestroy() {
        if (mEnhancedAdapter != null) {
            mEnhancedAdapter.destroy();
        }
        super.onDestroy();
    }
}
```

### æ­¥éª¤3: æ·»åŠ è®¾ç½®é€‰é¡¹ (å¯é€‰)
åœ¨ `Settings.java` ä¸­æ·»åŠ ç›¸å…³é…ç½®ï¼š

```java
public class Settings {
    // ... ç°æœ‰è®¾ç½® ...
    
    // ç”»å»Šåˆ—è¡¨ä¼˜åŒ–è®¾ç½®
    private static final String KEY_ENABLE_GALLERY_LIST_CACHE = "enable_gallery_list_cache";
    private static final String KEY_PRELOAD_GALLERY_LIST = "preload_gallery_list";
    private static final String KEY_GALLERY_CACHE_SIZE = "gallery_cache_size";
    
    public static boolean getEnableGalleryListCache() {
        return getBooleanFromStr(KEY_ENABLE_GALLERY_LIST_CACHE, true);
    }
    
    public static boolean getPreloadGalleryList() {
        return getBooleanFromStr(KEY_PRELOAD_GALLERY_LIST, true);
    }
    
    public static int getGalleryCacheSize() {
        return getIntFromStr(KEY_GALLERY_CACHE_SIZE, 50);
    }
}
```

### æ­¥éª¤4: æƒé™æ£€æŸ¥
ç¡®ä¿ AndroidManifest.xml åŒ…å«å¿…è¦æƒé™ï¼š
```xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
```

## ğŸ§ª **æµ‹è¯•éªŒè¯æ–¹æ¡ˆ**

### æ€§èƒ½æµ‹è¯•æŒ‡æ ‡

#### 1. **åŠ è½½æ—¶é—´å¯¹æ¯”**
```java
æµ‹è¯•åœºæ™¯ï¼š
- é¦–æ¬¡åŠ è½½æ—¶é—´ (å†·å¯åŠ¨)
- ç¼“å­˜å‘½ä¸­æ—¶é—´ (çƒ­å¯åŠ¨)  
- ç½‘ç»œé‡è¿ååŠ è½½æ—¶é—´
- å¤§åˆ—è¡¨(50+é¡¹)åŠ è½½æ—¶é—´

æœŸæœ›æ”¹è¿›ï¼š
- é¦–æ¬¡åŠ è½½: 3-5ç§’ â†’ 2-3ç§’ (40%æå‡)
- ç¼“å­˜å‘½ä¸­: 1-2ç§’ â†’ <300ms (70%æå‡)
- å¤§åˆ—è¡¨: 8-12ç§’ â†’ 4-6ç§’ (50%æå‡)
```

#### 2. **ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**
```java
æµ‹è¯•åœºæ™¯ï¼š
- ç¿»é¡µå“åº”æ—¶é—´
- æ»šåŠ¨æµç•…åº¦ (FPS)
- é”™è¯¯æ¢å¤æ—¶é—´
- æ— ç½‘ç»œç¯å¢ƒå¤„ç†

æœŸæœ›æ”¹è¿›ï¼š
- ç¿»é¡µå“åº”: 500-1000ms â†’ <200ms
- æ»šåŠ¨FPS: 45-50 â†’ 55-60
- é”™è¯¯æ¢å¤: æ‰‹åŠ¨é‡è¯• â†’ è‡ªåŠ¨é‡è¯•
- ç¦»çº¿å¤„ç†: å´©æºƒ â†’ ä¼˜é›…é™çº§
```

#### 3. **ç½‘ç»œæ•ˆç‡æŒ‡æ ‡**
```java
æµ‹è¯•åœºæ™¯ï¼š
- ç¼“å­˜å‘½ä¸­ç‡
- é‡å¤è¯·æ±‚å‡å°‘ç‡
- å¼±ç½‘ç¯å¢ƒæˆåŠŸç‡
- æµé‡æ¶ˆè€—å¯¹æ¯”

æœŸæœ›æ”¹è¿›ï¼š
- ç¼“å­˜å‘½ä¸­ç‡: 0% â†’ 60-80%
- é‡å¤è¯·æ±‚: -90% (å¤§å¹…å‡å°‘)
- å¼±ç½‘æˆåŠŸç‡: 60% â†’ 85%+
- æµé‡èŠ‚çœ: 30-50%
```

### è‡ªåŠ¨åŒ–æµ‹è¯•

#### åˆ›å»ºæµ‹è¯•ç±»
```java
// app/src/androidTest/java/com/hippo/ehviewer/test/
public class GalleryListOptimizationTest {
    
    @Test
    public void testBasicLoading() {
        // æµ‹è¯•åŸºæœ¬åŠ è½½åŠŸèƒ½
    }
    
    @Test
    public void testCacheMechanism() {
        // æµ‹è¯•ç¼“å­˜æœºåˆ¶
    }
    
    @Test
    public void testConcurrentLoading() {
        // æµ‹è¯•å¹¶å‘åŠ è½½æ€§èƒ½
    }
    
    @Test
    public void testMemoryUsage() {
        // æµ‹è¯•å†…å­˜ä½¿ç”¨
    }
    
    @Test
    public void testNetworkDetection() {
        // æµ‹è¯•ç½‘ç»œæ£€æµ‹
    }
    
    @Test
    public void performanceBenchmark() {
        // æ€§èƒ½åŸºå‡†æµ‹è¯•
    }
}
```

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

#### åŸºæœ¬åŠŸèƒ½éªŒè¯
- [ ] ç”»å»Šåˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
- [ ] ç¿»é¡µåŠŸèƒ½æ­£å¸¸
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] æ”¶è—å¤¹è®¿é—®æ­£å¸¸

#### æ€§èƒ½ä¼˜åŒ–éªŒè¯
- [ ] é¦–æ¬¡åŠ è½½æ˜æ˜¾åŠ é€Ÿ
- [ ] é‡å¤è®¿é—®å³æ—¶æ˜¾ç¤º (ç¼“å­˜å‘½ä¸­)
- [ ] ç¿»é¡µæµç•…æ— å¡é¡¿
- [ ] å¼±ç½‘ç¯å¢ƒä¸‹ä»èƒ½æ­£å¸¸ä½¿ç”¨

#### è¾¹ç•Œæƒ…å†µæµ‹è¯•
- [ ] æ— ç½‘ç»œè¿æ¥æ—¶çš„ä¼˜é›…å¤„ç†
- [ ] æœåŠ¡å™¨é”™è¯¯æ—¶çš„é‡è¯•æœºåˆ¶
- [ ] å¤§é‡æ•°æ®åŠ è½½æ—¶çš„æ€§èƒ½è¡¨ç°
- [ ] é•¿æ—¶é—´ä½¿ç”¨åæ— å†…å­˜æ³„æ¼

## ğŸ“ˆ **é¢„æœŸä¼˜åŒ–æ•ˆæœ**

### å…³é”®æ€§èƒ½æŒ‡æ ‡æ”¹è¿›

```
åŠ è½½é€Ÿåº¦æå‡: 50-70%
â”œâ”€â”€ é¦–æ¬¡åŠ è½½: 4ç§’ â†’ 2.5ç§’ (37.5%æå‡)
â”œâ”€â”€ ç¼“å­˜å‘½ä¸­: 1.5ç§’ â†’ 0.2ç§’ (86.7%æå‡)
â””â”€â”€ ç¿»é¡µå“åº”: 800ms â†’ 150ms (81.3%æå‡)

ç”¨æˆ·ä½“éªŒæå‡: 80%
â”œâ”€â”€ ç•Œé¢æµç•…åº¦: æ˜æ˜¾æ”¹å–„
â”œâ”€â”€ é”™è¯¯å¤„ç†: è‡ªåŠ¨é‡è¯•æœºåˆ¶
â”œâ”€â”€ è§†è§‰åé¦ˆ: åŠ è½½çŠ¶æ€å¯è§†åŒ–
â””â”€â”€ ç½‘ç»œé€‚åº”: å¼±ç½‘ç¯å¢ƒä¼˜åŒ–

ç³»ç»Ÿæ€§èƒ½æå‡: 60%
â”œâ”€â”€ å†…å­˜ä½¿ç”¨: æ›´åŠ é«˜æ•ˆçš„ç¼“å­˜ç®¡ç†
â”œâ”€â”€ ç½‘ç»œè¯·æ±‚: -60% é‡å¤è¯·æ±‚
â”œâ”€â”€ CPUå ç”¨: -30% ä¸»çº¿ç¨‹è´Ÿè½½
â””â”€â”€ ç”µæ± ç»­èˆª: +15-25%
```

### æŠ€æœ¯æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›å¹…åº¦ |
|---------|--------|--------|----------|
| é¦–æ¬¡åŠ è½½æ—¶é—´ | 4-6ç§’ | 2-3ç§’ | **50%â†‘** |
| ç¼“å­˜å‘½ä¸­åŠ è½½ | N/A | <300ms | **æ–°åŠŸèƒ½** |
| ç¿»é¡µå“åº”æ—¶é—´ | 500-1000ms | <200ms | **75%â†‘** |
| ç½‘ç»œé”™è¯¯æ¢å¤ | æ‰‹åŠ¨é‡è¯• | è‡ªåŠ¨é‡è¯• | **100%â†‘** |
| å†…å­˜å ç”¨å³°å€¼ | ä¸å¯æ§ | å—é™ç®¡ç† | **ç¨³å®š** |
| ç¼“å­˜å‘½ä¸­ç‡ | 0% | 60-80% | **æ–°åŠŸèƒ½** |
| å¼±ç½‘æˆåŠŸç‡ | 60-70% | 85%+ | **25%â†‘** |

### ç”¨æˆ·æ„ŸçŸ¥æ”¹è¿›

```
ç«‹å³å“åº”æ„Ÿ: å¤§å¹…æå‡
â”œâ”€â”€ ç¼“å­˜å‘½ä¸­æ—¶é¡µé¢ç¬é—´æ˜¾ç¤º
â”œâ”€â”€ é¢„åŠ è½½è®©ç¿»é¡µå˜å¾—ä¸æ»‘
â””â”€â”€ æ™ºèƒ½é‡è¯•å‡å°‘ç”¨æˆ·ç­‰å¾…

ç½‘ç»œé€‚åº”æ€§: å…¨é¢å¢å¼º
â”œâ”€â”€ WiFi: æ¿€è¿›é¢„åŠ è½½ç­–ç•¥
â”œâ”€â”€ 4G: å¹³è¡¡çš„åŠ è½½ç­–ç•¥
â”œâ”€â”€ 3G: ä¿å®ˆçš„é¢„åŠ è½½ç­–ç•¥
â””â”€â”€ 2G: æœ€å°åŒ–ç½‘ç»œä½¿ç”¨

é”™è¯¯å¤„ç†: äººæ€§åŒ–
â”œâ”€â”€ å‹å¥½çš„é”™è¯¯æç¤ºä¿¡æ¯
â”œâ”€â”€ ä¸€é”®é‡è¯•åŠŸèƒ½
â”œâ”€â”€ è‡ªåŠ¨é‡è¿æœºåˆ¶
â””â”€â”€ ç½‘ç»œçŠ¶æ€å®æ—¶æç¤º
```

## âš™ï¸ **é«˜çº§é…ç½®é€‰é¡¹**

### ç½‘ç»œç­–ç•¥è°ƒä¼˜
```java
// æ ¹æ®è®¾å¤‡æ€§èƒ½è°ƒæ•´é…ç½®
public class OptimizationConfig {
    
    // é«˜ç«¯è®¾å¤‡é…ç½® (8GB+ RAM)
    public static final Config HIGH_END = new Config()
        .setPreloadDistance(5)
        .setCacheSize(80)
        .setHighPriorityThreads(6)
        .setLowPriorityThreads(3);
    
    // ä¸­ç«¯è®¾å¤‡é…ç½® (4-8GB RAM)
    public static final Config MID_RANGE = new Config()
        .setPreloadDistance(3)
        .setCacheSize(50)
        .setHighPriorityThreads(4)
        .setLowPriorityThreads(2);
    
    // ä½ç«¯è®¾å¤‡é…ç½® (<4GB RAM)
    public static final Config LOW_END = new Config()
        .setPreloadDistance(2)
        .setCacheSize(25)
        .setHighPriorityThreads(2)
        .setLowPriorityThreads(1);
}
```

### ç¼“å­˜ç­–ç•¥è‡ªå®šä¹‰
```java
// ç¼“å­˜æ¸…ç†ç­–ç•¥
public enum CacheCleanupStrategy {
    AGGRESSIVE,    // ç§¯ææ¸…ç†ï¼ŒèŠ‚çœå†…å­˜
    BALANCED,      // å¹³è¡¡ç­–ç•¥ï¼Œå…¼é¡¾æ€§èƒ½å’Œå†…å­˜
    CONSERVATIVE   // ä¿å®ˆç­–ç•¥ï¼Œä¼˜å…ˆæ€§èƒ½
}
```

### ç½‘ç»œé‡è¯•ç­–ç•¥
```java
// é‡è¯•é…ç½®
public class RetryConfig {
    public int maxRetries = 3;           // æœ€å¤§é‡è¯•æ¬¡æ•°
    public long baseDelay = 1000;        // åŸºç¡€å»¶è¿Ÿ(ms)
    public double backoffMultiplier = 2.0; // é€€é¿å€æ•°
    public long maxDelay = 30000;        // æœ€å¤§å»¶è¿Ÿ(ms)
}
```

## ğŸ”§ **æ•…éšœæ’æŸ¥æŒ‡å—**

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. ç¼“å­˜æœªå‘½ä¸­é—®é¢˜
**ç—‡çŠ¶**: é‡å¤åŠ è½½ç›¸åŒé¡µé¢æ—¶ä»ç„¶å¾ˆæ…¢
```java
// æ£€æŸ¥æ–¹æ³•
String stats = adapter.getPerformanceStats();
Log.d("Cache", stats); // æŸ¥çœ‹ç¼“å­˜å‘½ä¸­ç‡

// è§£å†³æ–¹æ¡ˆ
adapter.refreshCache(url, mode); // å¼ºåˆ¶åˆ·æ–°ç¼“å­˜
```

#### 2. å†…å­˜å ç”¨è¿‡é«˜
**ç—‡çŠ¶**: åº”ç”¨ä½¿ç”¨è¿‡ç¨‹ä¸­å†…å­˜ä¸æ–­å¢é•¿
```java
// å®šæœŸæ¸…ç†
adapter.cleanupCache(); // æ¸…ç†è¿‡æœŸç¼“å­˜

// è°ƒæ•´ç¼“å­˜å¤§å°
Config config = new Config().setCacheSize(25); // å‡å°ç¼“å­˜
```

#### 3. ç½‘ç»œæ£€æµ‹ä¸å‡†ç¡®
**ç—‡çŠ¶**: åœ¨WiFiç¯å¢ƒä¸‹ä»ä½¿ç”¨2Gç­–ç•¥
```java
// éªŒè¯ç½‘ç»œæ£€æµ‹
NetworkUtils.NetworkType type = NetworkUtils.getNetworkType(context);
Log.d("Network", "Type: " + type);

// æ‰‹åŠ¨è®¾ç½®ç½‘ç»œç±»å‹
NetworkUtils.setNetworkTypeOverride(NetworkUtils.NetworkType.WIFI);
```

#### 4. é¢„åŠ è½½è¿‡äºæ¿€è¿›
**ç—‡çŠ¶**: æµé‡æ¶ˆè€—è¿‡å¿«æˆ–åŠ è½½å¡é¡¿
```java
// è°ƒæ•´é¢„åŠ è½½è·ç¦»
int distance = NetworkUtils.getRecommendedPreloadPages(context);
// æˆ–è€…ç›´æ¥å…³é—­é¢„åŠ è½½
Settings.setPreloadGalleryList(false);
```

### æ€§èƒ½ç›‘æ§å»ºè®®
```java
// å®šæœŸè¾“å‡ºæ€§èƒ½ç»Ÿè®¡
Handler handler = new Handler();
handler.postDelayed(new Runnable() {
    @Override
    public void run() {
        String stats = adapter.getPerformanceStats();
        Log.i("Performance", stats);
        
        // ä¸ŠæŠ¥åˆ°Analytics (å¯é€‰)
        FirebaseAnalytics.logEvent("gallery_performance", stats);
        
        handler.postDelayed(this, 30000); // 30ç§’é—´éš”
    }
}, 30000);
```

## ğŸ‰ **æ€»ç»“**

è¿™å¥—å®Œæ•´çš„ç”»å»Šåˆ—è¡¨ä¼˜åŒ–æ–¹æ¡ˆé€šè¿‡ä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯å…¨é¢æå‡äº† EhViewer çš„ç”¨æˆ·ä½“éªŒï¼š

### ğŸ’¡ **æ ¸å¿ƒåˆ›æ–°ç‚¹**
1. **é›¶ä¾µå…¥é›†æˆ**: æ— éœ€ä¿®æ”¹ç°æœ‰EhEngineå’ŒEhClientæ ¸å¿ƒä»£ç 
2. **æ™ºèƒ½è‡ªé€‚åº”**: æ ¹æ®ç½‘ç»œç¯å¢ƒå’Œè®¾å¤‡æ€§èƒ½è‡ªåŠ¨è°ƒæ•´ç­–ç•¥
3. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**: ç¼“å­˜å‘½ä¸­æ—¶ç¬é—´æ˜¾ç¤ºï¼Œå¼±ç½‘ç¯å¢ƒä¸‹ä¼˜é›…é™çº§
4. **å…¨é¢æ€§èƒ½ç›‘æ§**: å®æ—¶ç»Ÿè®¡å’Œé—®é¢˜è¯Šæ–­èƒ½åŠ›
5. **æ¸è¿›å¼å¢å¼º**: å¯é€æ­¥å¯ç”¨å„é¡¹ä¼˜åŒ–åŠŸèƒ½

### ğŸ¯ **é¢„æœŸæ”¶ç›Š**
- **å¼€å‘æ•ˆç‡**: å¿«é€Ÿé›†æˆï¼Œæœ€å°åŒ–ä»£ç ä¿®æ”¹
- **ç”¨æˆ·æ»¡æ„åº¦**: æ˜¾è‘—æ”¹å–„åŠ è½½é€Ÿåº¦å’Œæµç•…åº¦
- **ç³»ç»Ÿç¨³å®šæ€§**: æ™ºèƒ½å†…å­˜ç®¡ç†å’Œé”™è¯¯å¤„ç†
- **è¿è¥æˆæœ¬**: å‡å°‘æœåŠ¡å™¨å‹åŠ›å’Œç”¨æˆ·æµå¤±

### ğŸš€ **å®æ–½å»ºè®®**
1. **åˆ†é˜¶æ®µéƒ¨ç½²**: å…ˆå¯ç”¨ç¼“å­˜ï¼Œå†å¼€å¯é¢„åŠ è½½
2. **A/Bæµ‹è¯•**: å¯¹æ¯”ä¼˜åŒ–å‰åçš„ç”¨æˆ·è¡Œä¸ºæ•°æ®
3. **ç”¨æˆ·åé¦ˆ**: æ”¶é›†ç”¨æˆ·ä½“éªŒåé¦ˆæŒç»­ä¼˜åŒ–
4. **æ€§èƒ½ç›‘æ§**: å»ºç«‹é•¿æœŸçš„æ€§èƒ½ç›‘æ§ä½“ç³»

---

*ä¼˜åŒ–æ–¹æ¡ˆåˆ›å»ºæ—¶é—´: 2025-09-08*  
*ç‰ˆæœ¬: v1.0 - ä¼ä¸šçº§æ€§èƒ½ä¼˜åŒ–*  
*å…¼å®¹æ€§: EhViewer v2.0.0.1+ | Android API 23+*  
*é¢„ä¼°å®æ–½æ—¶é—´: 2-3ä¸ªå·¥ä½œæ—¥*