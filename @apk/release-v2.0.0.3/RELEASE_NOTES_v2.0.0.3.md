# EhViewer v2.0.0.3 正式版发布说明

> **王子公主** - 功能强大的Android图片浏览器应用
> 
> 发布时间: 2025年9月10日 | 版本: 2.0.0.3 | 构建: 200003

---

## 📦 发布包信息

### 渠道包列表

| 渠道号 | 渠道名称 | APK文件名 | 文件大小 | MD5校验和 | 适用场景 |
|--------|----------|-----------|----------|-----------|----------|
| **0000** | 默认版本 | `EhViewer-v2.0.0.3-channel-0000-default.apk` | 24MB | `c154b1ee82b1a11e7c3ca56f2e2b42b2` | 直接下载用户 |
| **3001** | 合作渠道 | `EhViewer-v2.0.0.3-channel-3001-partner.apk` | 24MB | `babaaabda9c0a98d92210f98adda92c6` | 渠道推广统计 |

### 系统要求
- **Android版本**: 6.0 (API 23) 及以上
- **RAM**: 建议2GB以上
- **存储空间**: 100MB以上可用空间
- **权限**: 存储权限（文件管理功能必需）

---

## 🎯 核心功能特性

### 🌐 内置浏览器引擎
- **双内核支持**: 腾讯X5 WebView + 原生WebView智能降级
- **完整浏览功能**: 地址栏、书签管理、历史记录、多标签页
- **用户脚本系统**: 20+预置增强脚本，Tampermonkey兼容
- **智能下载**: 集成下载管理器，支持断点续传
- **文件关联**: APK安装、多媒体播放、文档查看

### 📊 渠道统计系统 (⭐ v2.0.0.3新增)
- **智能重试机制**: 指数退避算法，网络异常自动重试
- **本地缓存队列**: 离线缓存失败请求，联网后自动发送
- **频率控制**: 1分钟内最多1次统计，避免重复请求
- **三大统计维度**:
  - 📱 **安装统计**: 点击画廊任意按钮时触发
  - 🌐 **下载统计**: 浏览器成功访问网页时触发
  - 🎯 **激活统计**: 每天软件打开超过10次时触发

### 🔧 用户脚本引擎
- **脚本库**: 20+预置增强脚本
  - `universal_ad_blocker.js` - 通用广告拦截
  - `baidu_app_blocker.js` - 百度应用拦截
  - `video_player_enhancer.js` - 视频播放增强
  - `bilibili_enhancer.js` - B站功能增强
  - `zhihu_enhancer.js` - 知乎体验优化
- **自动注入**: 根据URL规则智能加载对应脚本
- **Tampermonkey兼容**: 支持标准GM_API

### 📂 文件管理器
- **完整功能**: 文件浏览、复制、移动、删除、搜索
- **多媒体支持**: 图片查看、视频播放、音频播放
- **文档预览**: PDF、Office文档在线查看
- **压缩包支持**: 7Zip直接浏览和提取
- **APK安装器**: 一键安装Android应用
- **云存储**: 支持外部存储和网络位置

### 🎯 画廊系统 (核心功能)
- **多源浏览**: 网络画廊、本地压缩包、目录浏览
- **智能缓存**: 图片预加载和磁盘缓存管理
- **批量下载**: 支持断点续传和后台下载
- **标签系统**: 用户标签、分类过滤、黑名单
- **收藏同步**: 本地收藏和云端同步

---

## 🚀 v2.0.0.3 重大改进

### 🔄 网络稳定性提升
#### 渠道统计API重试机制
- **问题解决**: 修复了原有渠道统计缺乏重试机制的问题
- **智能重试**: 实现指数退避算法 (1秒 → 2秒 → 4秒)，最多重试3次
- **本地缓存**: 失败请求自动缓存到SharedPreferences，网络恢复后重试
- **超时优化**: 网络超时从5秒增加到8秒，适应弱网环境
- **网络检测**: 使用ConnectivityManager智能检测网络状态

#### 频率控制机制
- **防重复**: 替换原有防重复验证，使用时间间隔控制
- **频率限制**: 每种统计类型1分钟内最多发送1次
- **资源友好**: 避免过度请求，减少服务器压力

#### 管理接口扩展
```java
// 新增管理API
channelTracker.retryPendingRequestsManually(); // 手动重试
int count = channelTracker.getPendingRequestCount(); // 查询待发送数量  
channelTracker.clearAllCache(); // 清理缓存数据
```

### 📈 技术改进
- **代码质量**: 增加完善的异常处理和日志记录
- **内存优化**: 待发送请求队列最多50个，24小时自动过期
- **线程安全**: 使用Handler处理延迟重试，避免阻塞主线程
- **向后兼容**: 保持现有API接口不变，零配置启用

---

## 🛠️ 技术规格

### 编译环境
- **编译SDK**: Android 35
- **目标SDK**: Android 34
- **最小SDK**: Android 23
- **Java版本**: JDK 17
- **Gradle**: 8.x + Android Gradle Plugin

### 核心依赖
```kotlin
// 网络和解析
implementation("com.squareup.okhttp3:okhttp:3.14.7")
implementation("org.jsoup:jsoup:1.15.3")
implementation("com.alibaba:fastjson:1.2.83")

// 浏览器内核
implementation("com.tencent.tbs:tbssdk:44286")

// 数据库
implementation("org.greenrobot:greendao:3.0.0")

// 分析统计
implementation("com.google.firebase:firebase-analytics:22.4.0")
implementation("com.google.firebase:firebase-crashlytics:19.4.2")
```

### 支持架构
- **ARM64**: arm64-v8a (主要)
- **ARM32**: armeabi-v7a (兼容)
- **x86_64**: x86_64 (模拟器)
- **x86**: x86 (兼容)

### 签名信息
- **签名类型**: Release签名
- **证书**: debug.keystore (开发版本)
- **混淆**: 已关闭（便于调试和反馈）

---

## 📱 安装指南

### 渠道选择建议
- **个人用户**: 选择渠道0000（默认版本）
- **推广合作**: 选择渠道3001（合作渠道），支持推广效果统计
- **功能对比**: 两个渠道功能完全相同，仅统计后台不同

### 安装步骤
1. **下载APK**: 选择对应渠道的APK文件
2. **启用权限**: 设置 → 安全 → 允许安装未知应用
3. **安装应用**: 点击APK文件，按提示完成安装
4. **初始化**: 首次启动会下载腾讯X5内核（约30MB）
5. **权限授予**: 授予存储权限以使用文件管理功能

### ⚠️ 重要提醒
- **存储权限**: Android 11+需要授予MANAGE_EXTERNAL_STORAGE权限
- **网络连接**: 首次使用需要联网下载浏览器内核
- **版本更新**: 安装前请先卸载旧版本（如有）
- **数据备份**: 安装前建议备份重要数据

---

## 🔧 故障排除

### 常见问题解决

#### Q: 应用无法安装？
**A**: 
1. 检查是否开启"未知来源"权限
2. 确认Android版本不低于6.0
3. 清理安装包下载目录重新下载
4. 卸载旧版本后重新安装

#### Q: 浏览器功能无法使用？
**A**:
1. 检查网络连接，确保能访问互联网
2. 等待X5内核下载完成（首次启动需要）
3. 如果X5内核下载失败，应用会自动降级到原生WebView
4. 重启应用或清除应用数据

#### Q: 文件管理功能提示权限不足？
**A**:
1. Android 11+：设置 → 应用 → 特殊权限 → 所有文件访问权限
2. Android 10及以下：检查存储权限是否已授予
3. 部分厂商ROM需要额外设置存储权限

#### Q: 统计功能异常？
**A**:
1. 检查网络连接是否正常
2. 查看应用日志，搜索"ChannelTracker"关键词
3. 重试机制会自动处理临时网络问题
4. 如持续异常，可手动清除应用数据重置

#### Q: 性能问题或卡顿？
**A**:
1. 确保可用内存不少于1GB
2. 清理应用缓存：设置 → 应用 → 存储 → 清除缓存
3. 重启设备释放系统资源
4. 关闭不必要的后台应用

---

## 📊 数据统计说明

### 统计数据收集
为了改进产品质量和用户体验，应用会收集以下匿名统计数据：

#### 收集的信息
- **设备信息**: 设备型号、操作系统版本、屏幕分辨率
- **使用统计**: 功能使用频次、会话时长、错误日志
- **渠道统计**: 安装来源、激活状态（用于推广效果分析）

#### 数据保护
- **匿名处理**: 所有数据均匿名收集，不涉及个人身份
- **本地优先**: 敏感数据优先本地处理，仅上传必要统计
- **用户控制**: 可在设置中关闭统计功能（Firebase Analytics）
- **安全传输**: 使用HTTPS加密传输所有数据

#### 数据用途
- **产品改进**: 分析用户行为优化产品功能
- **错误修复**: 通过崩溃日志快速定位和修复问题  
- **渠道分析**: 评估推广效果，优化市场策略
- **性能优化**: 根据使用数据优化应用性能

---

## 🤝 社区与支持

### 开发团队
- **开发者**: EhViewer团队
- **项目性质**: 开源项目
- **许可证**: Apache License 2.0

### 获得帮助
- **用户手册**: 应用内置帮助文档
- **在线支持**: 通过应用内反馈功能
- **社区讨论**: GitHub Issues和讨论区
- **更新通知**: 关注项目GitHub仓库

### 参与贡献
- **代码贡献**: 欢迎提交Pull Request
- **问题反馈**: 通过GitHub Issues报告问题
- **功能建议**: 在Discussion区域提出建议
- **翻译帮助**: 协助完善多语言支持

---

## 📋 版本历史

### v2.0.0.3 (2025-09-10) - 当前版本
- ✅ **新增**: 渠道统计API重试机制和频率控制
- ✅ **优化**: 网络超时时间和异常处理
- ✅ **修复**: 依赖冲突和构建问题
- ✅ **增强**: 统计数据的可靠性和准确性

### v2.0.0.1 (历史版本)
- 🎯 **发布**: 基础功能版本
- 🌐 **内置**: 浏览器引擎和用户脚本系统
- 📂 **集成**: 文件管理和多媒体支持
- 📊 **添加**: 基础渠道统计功能

---

## 📞 联系信息

如有任何问题或建议，请通过以下方式联系：

- **项目主页**: [GitHub Repository]
- **问题反馈**: 应用内反馈功能
- **技术支持**: GitHub Issues
- **商务合作**: 通过项目README联系方式

---

*发布时间: 2025年9月10日*  
*版本: v2.0.0.3*  
*构建编号: 200003*

**EhViewer团队 © 2025 | 基于Apache License 2.0开源协议**